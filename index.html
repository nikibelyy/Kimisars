<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0a84ff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0a84ff" media="(prefers-color-scheme: dark)">
  <title>Калькулятор процентов — iOS-style</title>
  <style>
    /* ====== iOS-like Design System (no external assets) ====== */
    :root{
      --tint: #0a84ff;          /* iOS blue */
      --tint-2: color-mix(in srgb, var(--tint) 70%, white);
      --bg: #f5f6f8;
      --text: #0b0c0f;
      --text-sec: #5b5d62;
      --card: rgba(255,255,255,0.7);
      --border: rgba(0,0,0,0.08);
      --shadow: 0 10px 30px rgba(0,0,0,.08), 0 2px 6px rgba(0,0,0,.05);
      --radius-outer: 28px;
      --radius: 18px;
      --radius-sm: 12px;
      --blur: 16px;
      --success: #34c759;
      --danger: #ff3b30;
      --warning: #ff9f0a;
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg: #0f1115;
        --text: #e8e9ec;
        --text-sec: #a9acb2;
        --card: rgba(22,24,29,0.55);
        --border: rgba(255,255,255,0.08);
        --shadow: 0 10px 35px rgba(0,0,0,.55), 0 2px 10px rgba(0,0,0,.4);
      }
    }

    html,body{
      height:100%;
      background: radial-gradient(1200px 800px at 80% -10%, color-mix(in srgb, var(--tint) 12%, var(--bg)) 0%, var(--bg) 50%) fixed;
      margin:0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      color:var(--text);
      font: 16px/1.35 -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial, system-ui, sans-serif;
    }

    .safe-area {
      padding: max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(16px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
    }

    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: saturate(140%) blur(14px);
      -webkit-backdrop-filter: saturate(140%) blur(14px);
      background: color-mix(in srgb, var(--card) 70%, transparent);
      border-bottom: 1px solid var(--border);
    }
    .nav{
      max-width: 920px; margin: 0 auto; display:flex; align-items:center; gap:12px;
      padding: 14px 12px;
    }
    .badge{
      inline-size: 34px; block-size:34px; flex:0 0 34px;
      border-radius: 10px; display:grid; place-items:center;
      background: linear-gradient(160deg, var(--tint), var(--tint-2));
      color:white; font-weight:700; letter-spacing:.2px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.2), 0 6px 14px rgba(10,132,255,.35);
    }
    .title{
      font-size: clamp(18px, 3vw, 22px); font-weight: 700; letter-spacing:.2px;
    }
    .subtitle{
      color:var(--text-sec); font-size: 13px;
    }

    main{
      max-width: 920px; margin: 24px auto; padding: 0 12px 28px;
      display:grid; gap:20px;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: var(--radius-outer);
      overflow:hidden;
    }
    .card .content{ padding: 18px; }
    .hero{
      display:grid; gap:12px; padding: 22px 18px 10px;
      background:
        radial-gradient(800px 400px at 10% -5%, color-mix(in srgb,var(--tint) 15%, transparent), transparent 60%),
        linear-gradient(180deg, color-mix(in srgb, var(--card) 70%, transparent), transparent);
    }
    .hero h1{
      margin:0; font-size: clamp(28px, 6vw, 44px); line-height:1.05;
      letter-spacing:-.3px;
    }
    .hero p{ margin:0; color:var(--text-sec); font-size: clamp(14px, 2.5vw, 16px); }

    /* Segmented control (iOS) */
    .segment{
      display:flex; gap:8px; padding:8px; border-radius: 20px;
      background: color-mix(in srgb, var(--bg) 70%, transparent);
      border:1px solid var(--border);
      overflow:auto;
    }
    .segment button{
      appearance:none; border:0; padding:10px 14px; border-radius: 14px;
      background: transparent; color: var(--text-sec);
      font-weight:600; white-space:nowrap; transition: transform .06s ease, background .2s ease, color .2s ease;
    }
    .segment button[aria-pressed="true"]{
      background: white; color:#111; box-shadow: 0 1px 0 rgba(0,0,0,.06), 0 10px 25px rgba(0,0,0,.08);
    }
    @media (prefers-color-scheme: dark){
      .segment button[aria-pressed="true"]{ background:#1b1f26; color:#fff; }
    }
    .segment button:active{ transform: scale(.98); }

    /* Form */
    .grid{ display:grid; gap:12px; grid-template-columns: 1fr; }
    @media (min-width: 720px){
      .grid{ grid-template-columns: 1fr 1fr; }
    }

    .field{
      display:grid; gap:8px; background: color-mix(in srgb, var(--card) 70%, transparent);
      border:1px solid var(--border); border-radius: var(--radius); padding: 14px;
    }
    .label{ font-size:13px; color:var(--text-sec); display:flex; justify-content:space-between; gap:8px; align-items:center; }
    .input{
      display:flex; gap:10px; align-items:center; background: white; border:1px solid var(--border);
      border-radius: 12px; padding: 10px 12px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6), 0 1px 0 rgba(0,0,0,.03);
    }
    @media (prefers-color-scheme: dark){
      .input{ background:#0f1217; box-shadow: inset 0 1px 0 rgba(255,255,255,.03), 0 1px 0 rgba(255,255,255,.02); }
    }
    .input input{
      border:0; outline:0; flex:1; min-width:0; background:transparent; color:inherit;
      font-size:clamp(16px, 2.6vw, 20px);
    }
    .suffix, .prefix{ font-family: var(--mono); opacity:.55; }
    .hint{ font-size:12px; color:var(--text-sec); }
    .error{ color:var(--danger); font-size:12px; display:none; }

    /* Primary button */
    .actions{
      display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:flex-start;
    }
    .btn{
      appearance:none; border:0; border-radius: 14px; padding: 12px 18px; font-weight:700;
      background: linear-gradient(180deg, color-mix(in srgb, var(--tint) 92%, white), var(--tint));
      color:white; box-shadow: 0 8px 20px rgba(10,132,255,.35), inset 0 0 0 1px rgba(255,255,255,.35);
      transition: transform .06s ease, filter .2s ease, opacity .2s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn[disabled]{ opacity:.5; pointer-events:none; }

    .btn-ghost{
      background: transparent; color: var(--tint); border:1px solid color-mix(in srgb, var(--tint) 50%, var(--border));
      box-shadow:none;
    }

    /* Result */
    .result{
      display:grid; gap:6px; border-radius: var(--radius); padding: 14px;
      border:1px dashed var(--border);
      background: color-mix(in srgb, var(--card) 60%, transparent);
    }
    .result .value{
      font-size: clamp(22px, 6vw, 36px); font-weight:800; letter-spacing:-.3px;
      display:flex; align-items:baseline; gap:8px; line-height:1.1;
    }
    .value small{ font-size:.45em; font-weight:600; color:var(--text-sec); }
    .copy{
      appearance:none; border:0; border-radius: 10px; padding:8px 10px; font-weight:600;
      background: color-mix(in srgb, var(--bg) 70%, transparent);
      border:1px solid var(--border); cursor:pointer;
    }

    /* Footer */
    footer{ color:var(--text-sec); font-size:12px; text-align:center; padding: 12px; }

    /* Motion preferences */
    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; animation:none !important; }
    }
  </style>
</head>
<body>
  <header class="safe-area">
    <div class="nav">
      <div class="badge">%</div>
      <div>
        <div class="title">Калькулятор процентов</div>
        <div class="subtitle">Минималистичный дизайн в стиле iOS</div>
      </div>
    </div>
  </header>

  <main class="safe-area">
    <section class="card">
      <div class="hero">
        <h1>Считайте проценты быстро, красиво и точно</h1>
        <p>Выберите режим, введите числа — результат появится автоматически. Работает офлайн.</p>
      </div>
      <div class="content">
        <!-- Segmented control -->
        <div class="segment" role="tablist" aria-label="Режимы вычислений">
          <button role="tab" aria-selected="true" aria-pressed="true" data-mode="of">Процент от числа</button>
          <button role="tab" aria-selected="false" aria-pressed="false" data-mode="increase">Увеличить на %</button>
          <button role="tab" aria-selected="false" aria-pressed="false" data-mode="decrease">Уменьшить на %</button>
          <button role="tab" aria-selected="false" aria-pressed="false" data-mode="what">Какой это % от</button>
          <button role="tab" aria-selected="false" aria-pressed="false" data-mode="find-whole">Найти число по %</button>
        </div>

        <!-- Dynamic form -->
        <div class="grid" id="fields">
          <!-- Поля подставляются скриптом -->
        </div>

        <div class="actions" style="margin-top:14px">
          <button class="btn" id="calcBtn">Посчитать</button>
          <button class="btn btn-ghost" id="clearBtn" aria-label="Очистить поля">Сбросить</button>
          <span class="hint" id="hint"></span>
        </div>

        <div class="result" style="margin-top:14px" aria-live="polite">
          <div class="label">Результат</div>
          <div class="value"><span id="out">—</span> <small id="outUnit"></small></div>
          <div style="display:flex; gap:8px; align-items:center;">
            <button class="copy" id="copyBtn">Скопировать</button>
            <span class="hint" id="copyHint" aria-live="polite"></span>
          </div>
        </div>
      </div>
    </section>

    <footer>
      Сделано для вас • Поддерживает светлую/тёмную темы • <span aria-hidden="true"></span>-вдохновение
    </footer>
  </main>

  <script>
    // ====== Utility: number parsing/formatting with care for locales ======
    const fmt = new Intl.NumberFormat('ru-RU', { maximumFractionDigits: 10 });
    function toNumber(v){
      if (typeof v === 'number') return v;
      // tolerate comma or space as thousand/decimal separators
      v = (v || '').toString().trim().replace(/\s+/g,'').replace(',', '.');
      if (!v) return NaN;
      return Number(v);
    }
    function tidy(n){
      // strip trailing zeros (e.g., 12.34000 -> 12.34)
      const s = n.toFixed(10).replace(/\.?0+$/, '');
      return s;
    }

    // ====== View templates for each mode ======
    const modes = {
      'of': {
        title: 'Процент от числа',
        fields: [
          { id:'a', label:'Число', suffix:'' , placeholder:'например, 2500' },
          { id:'b', label:'% (процентов)', suffix:'%' , placeholder:'например, 15' },
        ],
        unit: '',
        calc: ({a,b}) => (a*b/100),
        hint: 'Считает b% от числа a.'
      },
      'increase': {
        title: 'Увеличить число на %',
        fields: [
          { id:'a', label:'Исходное число', suffix:'' , placeholder:'например, 1990' },
          { id:'b', label:'Насколько увеличить (%)', suffix:'%' , placeholder:'например, 12' },
        ],
        unit: '',
        calc: ({a,b}) => (a*(1+b/100)),
        hint: 'Рассчитывает a, увеличенное на b%.'
      },
      'decrease': {
        title: 'Уменьшить число на %',
        fields: [
          { id:'a', label:'Исходное число', suffix:'' , placeholder:'например, 1990' },
          { id:'b', label:'Насколько уменьшить (%)', suffix:'%' , placeholder:'например, 12' },
        ],
        unit: '',
        calc: ({a,b}) => (a*(1-b/100)),
        hint: 'Рассчитывает a, уменьшенное на b%.'
      },
      'what': {
        title: 'Какой это процент от',
        fields: [
          { id:'a', label:'Часть (a)', suffix:'' , placeholder:'например, 45' },
          { id:'b', label:'Целое (b)', suffix:'' , placeholder:'например, 120' },
        ],
        unit: '%',
        calc: ({a,b}) => (b === 0 ? NaN : (a/b*100)),
        hint: 'Находит, какой процент составляет a от b.'
      },
      'find-whole': {
        title: 'Найти число по его проценту',
        fields: [
          { id:'a', label:'Известное значение (это b% от целого)', suffix:'' , placeholder:'например, 30' },
          { id:'b', label:'Сколько процентов (b)', suffix:'%' , placeholder:'например, 12' },
        ],
        unit: '',
        calc: ({a,b}) => (b === 0 ? NaN : (a*100/b)),
        hint: 'Если a — это b% от целого, находит целое.'
      }
    };

    const fieldsEl = document.getElementById('fields');
    const hintEl   = document.getElementById('hint');
    const outEl    = document.getElementById('out');
    const outUnit  = document.getElementById('outUnit');
    const copyBtn  = document.getElementById('copyBtn');
    const copyHint = document.getElementById('copyHint');
    const calcBtn  = document.getElementById('calcBtn');
    const clearBtn = document.getElementById('clearBtn');

    let currentMode = 'of';

    function render(modeKey){
      const m = modes[modeKey];
      currentMode = modeKey;

      // update segment states
      document.querySelectorAll('.segment button').forEach(btn=>{
        const active = btn.dataset.mode === modeKey;
        btn.setAttribute('aria-pressed', active ? 'true':'false');
        btn.setAttribute('aria-selected', active ? 'true':'false');
      });

      // build fields
      fieldsEl.innerHTML = '';
      m.fields.forEach(f=>{
        const wrap = document.createElement('div');
        wrap.className = 'field';
        wrap.innerHTML = `
          <div class="label">
            <label for="${f.id}">${f.label}</label>
            <span class="hint">${f.placeholder ? 'Например: ' + f.placeholder : ''}</span>
          </div>
          <div class="input">
            ${f.prefix ? `<span class="prefix">${f.prefix}</span>` : ''}
            <input id="${f.id}" inputmode="decimal" autocomplete="off" placeholder="${f.placeholder||''}" />
            ${f.suffix ? `<span class="suffix">${f.suffix}</span>` : ''}
          </div>
          <div class="error" id="${f.id}-err" role="alert">Введите корректное число.</div>
        `;
        fieldsEl.appendChild(wrap);
      });

      hintEl.textContent = m.hint;
      outEl.textContent = '—';
      outUnit.textContent = m.unit;
      copyHint.textContent = '';
      // auto-focus first field
      const first = document.getElementById(m.fields[0].id);
      if (first) first.focus();

      // live calculation
      m.fields.forEach(f=>{
        document.getElementById(f.id).addEventListener('input', autoCalc);
      });
    }

    function getValues(){
      const m = modes[currentMode];
      const vals = {};
      let ok = true;
      m.fields.forEach(f=>{
        const el = document.getElementById(f.id);
        const err = document.getElementById(`${f.id}-err`);
        const num = toNumber(el.value);
        const valid = !Number.isNaN(num) && Number.isFinite(num);
        err.style.display = valid || !el.value ? 'none' : 'block';
        vals[f.id] = num;
        if (!valid && el.value) ok = false;
      });
      return { ok, vals };
    }

    function compute(){
      const m = modes[currentMode];
      const { ok, vals } = getValues();
      if (!ok){ outEl.textContent = 'Ошибка'; outUnit.textContent=''; return; }

      // if any field empty -> don't compute yet
      const empty = m.fields.some(f => (document.getElementById(f.id).value.trim() === ''));
      if (empty){ outEl.textContent = '—'; outUnit.textContent = m.unit; return; }

      let res = m.calc(vals);
      if (Number.isNaN(res)){ outEl.textContent = 'Недопустимо'; outUnit.textContent=''; return; }

      // numeric safety for very small numbers
      if (Math.abs(res) < 1e-12) res = 0;

      // format
      const pretty = fmt.format(Number(tidy(res)));
      outEl.textContent = pretty;
      outUnit.textContent = m.unit;
    }

    function autoCalc(){ compute(); }

    // Actions
    calcBtn.addEventListener('click', compute);
    clearBtn.addEventListener('click', ()=>{
      const m = modes[currentMode];
      m.fields.forEach(f => document.getElementById(f.id).value = '');
      document.querySelectorAll('.error').forEach(e=> e.style.display='none');
      outEl.textContent = '—'; outUnit.textContent = m.unit; copyHint.textContent='';
      (document.getElementById(m.fields[0].id) || {}).focus?.();
    });

    copyBtn.addEventListener('click', async ()=>{
      const text = outUnit.textContent ? `${outEl.textContent} ${outUnit.textContent}` : outEl.textContent;
      try{
        await navigator.clipboard.writeText(text);
        copyHint.textContent = 'Скопировано ✔︎';
        copyHint.style.color = 'var(--success)';
        setTimeout(()=> copyHint.textContent = '', 1800);
      }catch{
        copyHint.textContent = 'Не удалось скопировать';
        copyHint.style.color = 'var(--danger)';
      }
    });

    document.querySelectorAll('.segment button').forEach(btn=>{
      btn.addEventListener('click', ()=> render(btn.dataset.mode));
      btn.addEventListener('keydown', (e)=>{
        // roving focus with arrow keys
        if (e.key === 'ArrowRight' || e.key === 'ArrowLeft'){
          const buttons = Array.from(document.querySelectorAll('.segment button'));
          const i = buttons.indexOf(e.currentTarget);
          const dir = e.key === 'ArrowRight' ? 1 : -1;
          const next = buttons[(i + dir + buttons.length) % buttons.length];
          next.focus();
          next.click();
        }
      });
    });

    // Initialize
    render(currentMode);

    // Enter submits
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter'){
        const active = document.activeElement;
        if (active && active.tagName === 'INPUT'){
          compute();
        }
      }
    });
  </script>
</body>
</html>
