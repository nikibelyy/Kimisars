<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>CRM Клиенты (PWA)</title>

  <!-- iOS-like look & feel -->
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="CRM">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css">

  <script>
    // Регистрация service worker как можно раньше
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js');
      });
    }
  </script>
</head>
<body>
  <div id="app">
    <header class="nav">
      <div class="nav-title">CRM</div>
      <button class="nav-btn" id="installBtn" aria-label="Установить">Установить</button>
    </header>

    <main class="content">
      <!-- Карточка добавления клиента -->
      <section class="card">
        <h1>Добавить клиента</h1>
        <form id="clientForm" autocomplete="on">
          <div class="field">
            <label for="name">Имя</label>
            <input id="name" name="name" type="text" placeholder="Иван Иванов" required />
          </div>

          <div class="field">
            <label for="carNumber">Номер машины</label>
            <input id="carNumber" name="carNumber" type="text" inputmode="latin" placeholder="A123BC77" required />
          </div>

          <div class="field">
            <label for="carMake">Марка машины</label>
            <input id="carMake" name="carMake" type="text" placeholder="Toyota" required />
          </div>

          <div class="field">
            <label for="amount">Сумма расчёта</label>
            <input id="amount" name="amount" type="number" step="0.01" min="0" placeholder="0.00" required />
          </div>

          <div class="field">
            <label>Тип сделки</label>
            <div class="segment" role="tablist" aria-label="Тип сделки">
              <input type="radio" name="dealType" id="deal30" value="30" checked>
              <label for="deal30">30%</label>

              <input type="radio" name="dealType" id="deal25" value="25">
              <label for="deal25">25%</label>

              <input type="radio" name="dealType" id="dealCes" value="cession">
              <label for="dealCes">Цессия (15%)</label>
            </div>
          </div>

          <div class="field">
            <label>Моя зарплата</label>
            <output id="salaryPreview">0</output>
          </div>

          <div class="actions">
            <button type="submit" class="btn-primary">Сохранить</button>
            <button type="reset" class="btn-ghost">Очистить</button>
          </div>
        </form>
      </section>

      <!-- Поиск -->
      <section class="card">
        <div class="field">
          <label for="search">Поиск</label>
          <input id="search" type="search" placeholder="По имени, номеру, марке..." />
        </div>
      </section>

      <!-- Список клиентов -->
      <section class="card">
        <h2>Клиенты</h2>
        <ul id="clientList" class="list"></ul>
        <p id="emptyState" class="muted" hidden>Список пуст. Добавьте первого клиента ↑</p>
      </section>
    </main>

    <!-- iOS‑подобное модальное окно для редактирования -->
    <dialog id="editDialog">
      <form method="dialog" id="editForm">
        <header class="sheet-handle"></header>
        <h3>Редактирование</h3>

        <input type="hidden" id="editId">

        <div class="field">
          <label for="editName">Имя</label>
          <input id="editName" required>
        </div>

        <div class="field">
          <label for="editCarNumber">Номер машины</label>
          <input id="editCarNumber" required>
        </div>

        <div class="field">
          <label for="editCarMake">Марка машины</label>
          <input id="editCarMake" required>
        </div>

        <div class="field">
          <label for="editAmount">Сумма расчёта</label>
          <input id="editAmount" type="number" step="0.01" min="0" required>
        </div>

        <div class="field">
          <label>Тип сделки</label>
          <div class="segment">
            <input type="radio" name="editDealType" id="editDeal30" value="30" checked>
            <label for="editDeal30">30%</label>

            <input type="radio" name="editDealType" id="editDeal25" value="25">
            <label for="editDeal25">25%</label>

            <input type="radio" name="editDealType" id="editDealCes" value="cession">
            <label for="editDealCes">Цессия (15%)</label>
          </div>
        </div>

        <div class="field">
          <label>Моя зарплата</label>
          <output id="editSalary">0</output>
        </div>

        <menu class="sheet-actions">
          <button value="cancel" class="btn-ghost">Отмена</button>
          <button id="deleteBtn" class="btn-danger" type="button">Удалить</button>
          <button value="default" class="btn-primary">Сохранить</button>
        </menu>
      </form>
    </dialog>
  </div>

  <script src="app.js"></script>
</body>
</html>
